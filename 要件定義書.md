# 🎬 SNS動画営業ロープレ自動化システム 要件定義書

> AIが"相談者"を演じ、SNS動画制作営業のトレーニングを自動化
>
> 〜音声 × 映像 × AI講評で、フランチャイズ全店舗の営業力を標準化〜

---

## 🏢 プロジェクト概要

### ■ コンセプト

**「SNS動画営業力を、誰でも・どこでも・何度でもトレーニングできる時代へ。」**

AIが無料相談に来た相談者役を演じ、実際の営業現場に近いロールプレイを

**音声＋映像＋AI講評**で再現。

講師がいなくても、誰でも実践的な練習・フィードバックが可能になります。

### ■ ビジネスモデル

**対象企業**: SNS動画制作会社（フランチャイズ展開）

**事業規模**: 現在複数店舗、将来100店舗規模を想定

**無料相談フロー**:
```
顧客（相談者）が無料相談に来訪
    ↓
営業（相談員）が対応
    ├─ 現状のSNS運用をヒアリング
    ├─ 課題・目標を深掘り
    ├─ SNS動画制作サービスを提案
    └─ 契約・次のステップへ誘導
```

**特徴**:
- 営業が「売り込む」のではなく、相談者の課題を「解決する」スタイル
- 1次面談から契約まで複数回の面談を経て信頼関係を構築
- 既存顧客への追加営業も重要

---

## 🎯 導入の目的

| 課題 | 解決策 |
| --- | --- |
| 教育の属人化 | AIが講師・相談者役を再現し、標準化された営業トレーニングを提供 |
| フランチャイズ拡大による教育コスト増 | 自動応答・自動講評で講師の工数を削減、100店舗でも対応可能 |
| 面談フェーズごとの対応力の差 | 1次〜3次面談まで、段階に応じた練習が可能 |
| 新人の育成期間短縮 | いつでも・何度でも練習できる環境で早期戦力化 |

---

## 💡 システムの特徴

### 🔊 1. AIが"相談者役"を演じる

- 営業担当が話しかけると、AIが相談者役として自然に返答
- 1次面談（警戒心あり）〜追加営業（フランク）まで、関係性の変化を再現

構成：

- **音声認識（Whisper）** → 営業の発話を文字起こし
- **AI返答（GPT-4o-mini）** → 相談者役の自然応答
- **RAG検索（FAISS）** → 実際の無料相談録音30本から学習した多様な応答
- **音声合成（Web Speech API）** → 自然なAI音声で再生

---

### 🎥 2. 映像付きでリアルな練習体験

- 既存の**映像・画像・テロップ素材**を組み合わせ、返答内容に応じて自動切替
- 難しい映像生成は不要、素材を差し替えるだけで独自演出が可能
- `$AUTO`指定で字幕を自動反映

---

### 🧠 3. SNS動画営業特化のAI講評

- ロープレ終了後にAIが自動講評を生成
- **「ヒアリング力・共感力・提案力・信頼構築力」を5段階で採点**
- 良かった点・改善点・アドバイスを出力（JSON / CSV形式で保存可能）

**従来の営業評価との違い**:
| 従来の評価軸 | SNS動画営業特化の評価軸 |
|------------|---------------------|
| 質問力 | **ヒアリング力** - SNS運用状況・課題を引き出す |
| 傾聴力 | **共感力** - 相談者の不安に寄り添う |
| 提案力 | **提案力** - 動画制作の具体的な解決策を提示 |
| クロージング力 | **信頼構築力** - 押し売りせず、次のステップに自然誘導 |

---

### 🧩 4. 6段階のシナリオで実践的トレーニング

実際の営業フローに沿った6つのシナリオ:

```
[1次面談] 初回接触・関係構築
    ↓
[1.5次面談] 少し打ち解けた状態での情報交換
    ↓
[2次面談] 具体的な提案・検討
    ↓
[3次面談] クロージング・契約
    ↓
[キックオフMTG] プロジェクト開始・協力関係
    ↓
[追加営業] 既存顧客への新規提案
```

**各シナリオでAI相談者の態度が変化**:
- 1次面談: 警戒心あり、距離感
- 2次面談: 前向きだが慎重、条件確認
- 3次面談: ほぼ決定、最終確認
- キックオフ: 協力的、フランク
- 追加営業: 既存の信頼関係、予算は慎重

---

### 🏢 5. フランチャイズ100店舗対応

**Google認証 + 店舗コード方式**:
```
1. Googleアカウントでログイン（1クリック）
2. 店舗コード入力（例: STORE_001）
3. すぐに練習開始
```

**店舗管理機能**:
- 本部: 全店舗のデータ閲覧、店舗コード発行
- 店舗管理者: 自店舗のメンバー管理、スコア確認
- 営業担当: 練習・履歴閲覧

---

## 📚 シナリオ設計

### 6シナリオの詳細

#### 1️⃣ 1次面談（初回接触）

**フェーズ**: 初回接触

**AI相談者のペルソナ**:
```json
{
  "customer_role": "SNS担当者 or 経営者",
  "tone": "警戒心あり、慎重",
  "relationship": "初対面",
  "knowledge_level": "動画制作について不明",
  "decision_power": "情報収集段階",
  "pain_points": [
    "SNSの反応が悪い",
    "動画制作の知識がない",
    "予算が不明確",
    "他社との比較をしたい"
  ]
}
```

**典型的な会話**:
```
相談者: 「SNS動画って、どれくらいの予算でできますか？」
営業: 「ご予算はどれくらいでお考えですか？」
相談者: 「まだ分からなくて...検討段階なんです」
営業: 「なるほど。まず現状のSNS運用についてお聞かせください」
相談者: 「InstagramとTikTokをやっていますが、反応が悪くて...」
```

**評価のポイント**:
- ヒアリング力: SNS運用状況を自然に聞き出せるか
- 共感力: 不安を受け止められるか
- 信頼構築力: 押し売りせず、安心感を与えられるか

---

#### 2️⃣ 1.5次面談（関係構築）

**フェーズ**: 関係構築

**AI相談者のペルソナ**:
```json
{
  "tone": "少し打ち解けてきた",
  "relationship": "2回目",
  "knowledge_level": "基本的な理解はある",
  "decision_power": "まだ検討中",
  "pain_points": [
    "具体的な費用感が知りたい",
    "制作期間が気になる",
    "他社との違いが知りたい"
  ]
}
```

**評価のポイント**:
- ヒアリング力: 具体的な課題を深掘りできるか
- 提案力: サービス詳細を分かりやすく説明できるか

---

#### 3️⃣ 2次面談（提案・検討）

**フェーズ**: 提案・検討

**AI相談者のペルソナ**:
```json
{
  "tone": "前向きだが慎重",
  "relationship": "ある程度の信頼関係",
  "knowledge_level": "サービスを理解している",
  "decision_power": "社内で検討している",
  "pain_points": [
    "費用対効果が心配",
    "他社との最終比較",
    "社内稟議を通せるか"
  ]
}
```

**評価のポイント**:
- 提案力: 具体的な事例を示せるか
- 共感力: 懸念点に寄り添えるか

---

#### 4️⃣ 3次面談（クロージング）

**フェーズ**: クロージング

**AI相談者のペルソナ**:
```json
{
  "tone": "決定に向けて前向き",
  "relationship": "信頼関係が構築済み",
  "knowledge_level": "詳細まで理解",
  "decision_power": "ほぼ決定できる状態",
  "pain_points": [
    "最終的な条件確認",
    "契約の詳細が気になる",
    "スケジュールの調整"
  ]
}
```

**評価のポイント**:
- 信頼構築力: 自然にクロージングできるか
- 提案力: 最終条件を整理できるか

---

#### 5️⃣ キックオフMTG（プロジェクト開始）

**フェーズ**: プロジェクト開始

**AI相談者のペルソナ**:
```json
{
  "tone": "協力的、前向き",
  "relationship": "既にクライアント",
  "knowledge_level": "サービスを理解",
  "decision_power": "プロジェクト進行中",
  "pain_points": [
    "スムーズに進めたい",
    "何を準備すればいいか",
    "期待通りの成果が出るか"
  ]
}
```

**評価のポイント**:
- ヒアリング力: 必要な準備を確認できるか
- 信頼構築力: 協力関係を築けるか

---

#### 6️⃣ 追加営業（既存顧客への提案）

**フェーズ**: 既存顧客への提案

**AI相談者のペルソナ**:
```json
{
  "tone": "親しみやすい、フランク",
  "relationship": "既存の信頼関係",
  "knowledge_level": "サービスを経験済み",
  "decision_power": "前回の成果次第",
  "pain_points": [
    "前回の成果は満足",
    "でも予算は限られている",
    "本当に必要か検討したい"
  ]
}
```

**評価のポイント**:
- 提案力: 新たな価値を提案できるか
- 共感力: 予算の懸念に寄り添えるか

---

## 🎓 音声データから学習

### データソース

**既存の無料相談録音データ**: 30本
- 1次面談: 5本 × 30分
- 1.5次面談: 5本 × 30分
- 2次面談: 5本 × 30分
- 3次面談: 5本 × 30分
- キックオフMTG: 5本 × 30分
- 追加営業: 5本 × 30分

**合計**: 900分（15時間）の実録音声

### データ処理フロー

```
音声ファイル（mp3/wav）
    ↓
Whisper APIで文字起こし
    ↓
話者分離（営業・相談者）
    ↓
シナリオ別にタグ付け
    ├─ シーン（挨拶/ヒアリング/提案/クロージング）
    ├─ トピック（予算/期間/事例/競合）
    ├─ 感情（不安/興味/懸念/前向き）
    └─ 関係性レベル（1-5）
    ↓
相談者の発言を抽出（600-800件）
    ↓
Embedding生成（text-embedding-3-large）
    ↓
FAISS インデックスに登録
    ↓
シナリオ別RAG検索が可能に
```

### RAG検索の仕組み

```python
# 1次面談で練習中
営業: 「現状のSNS運用についてお聞かせください」
    ↓
RAG検索: scenario_id="meeting_1st" でフィルター
    ↓
類似する相談者発言トップ3を取得:
- 「Instagramをやっていますが、反応が悪くて...」
- 「動画は作ったことがないんです」
- 「他社も見ていて、比較したいです」
    ↓
GPT-4o-miniがこれらを参考に自然な応答を生成
    ↓
AI相談者: 「InstagramとTikTokです。でも反応が悪くて...」
```

**メリット**:
- 実際の相談者のような自然な応答
- シナリオに合った関係性・トーン
- 600-800件のバリエーション

---

## 🎯 評価基準（Rubric）- SNS動画営業特化

### 評価項目（4軸・均等配分）

| 評価軸 | 配点 | 定義 | SNS動画営業での意味 |
| --- | --- | --- | --- |
| **ヒアリング力** | 25% | 相談者の現状・課題・目標を的確に引き出す | SNS運用状況、ターゲット層、予算感を聞き出す |
| **共感力** | 25% | 相談者の不安・懸念に寄り添う | 「動画制作が不安」「予算が心配」に共感 |
| **提案力** | 25% | SNS動画制作の具体的な解決策を提示 | 事例を示し、相談者に合った動画を提案 |
| **信頼構築力** | 25% | 押し売りせず、次のステップに自然誘導 | 「お見積もり作成しますね」等の自然なクロージング |

### 5段階評価基準

#### ヒアリング力

| スコア | レベル | 説明 |
|--------|--------|------|
| 1 | ヒアリングなし | 一方的に話している |
| 2 | 表面的な質問のみ | 「どのSNSですか？」程度の質問のみ |
| 3 | 基本的なヒアリング | 現状と課題を確認している |
| 4 | 深掘りヒアリング | 目標・ターゲット・予算まで確認 |
| 5 | 本質的なヒアリング | 相談者の本当の悩み・目的を引き出している |

#### 共感力

| スコア | レベル | 説明 |
|--------|--------|------|
| 1 | 共感なし | 相談者の不安を無視 |
| 2 | 形式的な相槌のみ | 「そうですか」程度 |
| 3 | 基本的な共感 | 「その不安、分かります」 |
| 4 | 具体的な共感 | 不安を受け止め、安心させる |
| 5 | 深い共感＋解決策 | 不安を理解し、解消する道筋を示す |

#### 提案力

| スコア | レベル | 説明 |
|--------|--------|------|
| 1 | 提案なし | 具体的な提案が見られない |
| 2 | 抽象的な提案 | 「動画がいいですよ」程度 |
| 3 | 一般的な提案 | サービス紹介のみ |
| 4 | 具体的な提案 | 事例付きで提案 |
| 5 | カスタマイズ提案 | 相談者の課題に最適化された提案 |

#### 信頼構築力

| スコア | レベル | 説明 |
|--------|--------|------|
| 1 | 押し売り | 強引なクロージング |
| 2 | 唐突なクロージング | タイミングを誤る |
| 3 | 弱いクロージング | 曖昧な次のステップ |
| 4 | 自然な誘導 | 「お見積もり作成しますね」等 |
| 5 | 信頼ベースの誘導 | 相談者が安心して次に進める |

---

## 🏗️ システムアーキテクチャ

### 技術スタック

| 項目 | 使用技術 |
| --- | --- |
| **バックエンド** | Python（Flask） |
| **フロントエンド** | React 18 + TypeScript + Vite |
| **スタイリング** | Tailwind CSS |
| **データベース** | Supabase（PostgreSQL） |
| **認証** | Supabase Auth（Google OAuth） |
| **音声認識** | OpenAI Whisper API |
| **AI対話** | OpenAI GPT-4o-mini |
| **AI講評** | OpenAI GPT-4 |
| **音声合成** | Web Speech API（日本語TTS） |
| **RAG検索** | FAISS + OpenAI Embeddings（text-embedding-3-large） |
| **デプロイ** | Vercel（フロント）+ Railway/Render（バックエンド） |

### データベース設計（100店舗対応）

```sql
-- 店舗マスタ
CREATE TABLE stores (
  id UUID PRIMARY KEY,
  store_code TEXT UNIQUE NOT NULL,      -- "STORE_001", "STORE_002" ...
  store_name TEXT NOT NULL,             -- "東京銀座店"
  region TEXT,                          -- "関東", "関西" 等
  status TEXT DEFAULT 'active',
  created_at TIMESTAMP DEFAULT NOW()
);

-- ユーザー（Google認証）
CREATE TABLE profiles (
  id UUID PRIMARY KEY REFERENCES auth.users,
  store_id UUID REFERENCES stores,
  store_code TEXT,
  display_name TEXT NOT NULL,
  email TEXT UNIQUE NOT NULL,
  avatar_url TEXT,                      -- Googleアバター
  role TEXT DEFAULT 'user',             -- admin/manager/user
  created_at TIMESTAMP DEFAULT NOW(),
  last_active_at TIMESTAMP
);

-- 会話履歴
CREATE TABLE conversations (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES profiles,
  store_id UUID REFERENCES stores,
  scenario_id TEXT NOT NULL,            -- "meeting_1st", "meeting_2nd" ...
  scenario_title TEXT,
  messages JSONB NOT NULL,
  duration_seconds INT,
  created_at TIMESTAMP DEFAULT NOW()
);

-- 評価履歴
CREATE TABLE evaluations (
  id UUID PRIMARY KEY,
  conversation_id UUID REFERENCES conversations,
  user_id UUID REFERENCES profiles,
  store_id UUID REFERENCES stores,
  scenario_id TEXT NOT NULL,
  scores JSONB NOT NULL,                -- {hearing: 4, empathy: 5, ...}
  total_score INT,
  average_score DECIMAL(3,2),
  comments JSONB,
  created_at TIMESTAMP DEFAULT NOW()
);
```

### Row Level Security（RLS）

```sql
-- ユーザーは自分のデータのみ閲覧
CREATE POLICY "Users can view own data"
  ON conversations FOR SELECT
  USING (auth.uid() = user_id);

-- 店舗管理者は自店舗のデータを閲覧
CREATE POLICY "Managers can view store data"
  ON conversations FOR SELECT
  USING (
    EXISTS (
      SELECT 1 FROM profiles
      WHERE id = auth.uid()
        AND role = 'manager'
        AND store_id = conversations.store_id
    )
  );

-- 本部管理者は全データ閲覧
CREATE POLICY "Admins can view all data"
  ON conversations FOR SELECT
  USING (
    EXISTS (
      SELECT 1 FROM profiles
      WHERE id = auth.uid() AND role = 'admin'
    )
  );
```

---

## 📅 開発スケジュール（8週間・2ヶ月）

### Week 1: Google認証 + 店舗管理基盤 ✅ **完了（2025-11-11）**

- ✅ Supabaseプロジェクト作成
- ✅ Google OAuth設定
- ✅ データベース設計・構築（stores, profiles, conversations, evaluations）
- ✅ RLS設定
- ✅ Google認証UI（ログイン・登録・店舗コード入力）
- ✅ 本部管理者: 店舗コード発行UI
- ✅ ダークテーマUI統一

**成果物**: 認証付きアプリ（店舗コード必須） ← ✅ **達成**

---

### Week 2: 6シナリオ構築 + 音声データ処理

- 6シナリオのJSON作成（meeting_1st 〜 upsell）
- 音声データ30本の文字起こし（Whisper API）
- 話者分離（営業・相談者）
- シナリオ別タグ付け
- RAGインデックス構築（600-800件）
- シナリオ別検索機能実装

**成果物**: 6シナリオ + RAGデータ600-800件

---

### Week 3: データ永続化 + シナリオ切替UI

- Supabase統合（バックエンド）
- 会話履歴保存API
- 評価履歴保存API
- シナリオ選択UI（ヘッダー）
- 6シナリオ切り替え機能
- 自動保存機能

**成果物**: データが残るアプリ（6シナリオ対応）

---

### Week 4: 履歴閲覧 + CSV出力

- 過去の練習一覧（シナリオ別フィルター）
- 会話の再生（読み返し）
- 評価の振り返り
- スコア推移グラフ（Chart.js）
- シナリオ別平均スコア
- CSV出力機能（個人・店舗別）

**成果物**: 成長を可視化できるアプリ

---

### Week 5: 評価精度向上（重点）

- 各シナリオで実ロープレ（5-10回 × 6 = 30-60回）
- 講師評価との比較
- シナリオ別Few-shot作成（18-30件）
- Rubric調整（SNS動画営業特化）
- プロンプトチューニング
- GPT-4 vs GPT-4o-mini比較

**目標**: 講師評価との一致率80%

---

### Week 6: 店舗管理機能 + レポート

- 店舗管理者機能（自店舗メンバー・スコア確認）
- 本部管理者機能（全店舗サマリー・ランキング）
- リージョン別集計
- CSV一括出力

**成果物**: フランチャイズ管理機能完備

---

### Week 7: パフォーマンス最適化 + 同時利用対応

- データベース最適化（インデックス・クエリ）
- 同時アクセス対応（50人同時）
- APIレート制限
- キャッシング戦略
- エラーハンドリング強化

**成果物**: 100店舗対応・高速・安定稼働

---

### Week 8: テスト・ドキュメント・デプロイ

- 統合テスト（全機能・全シナリオ）
- デバイス別テスト（デスクトップ・モバイル）
- ロール別テスト（一般・管理者・本部）
- セキュリティチェック
- ドキュメント作成（ユーザー・管理者・システム）
- 本番デプロイ（Vercel + Railway + Supabase）

**成果物**: 本番稼働可能なシステム

---

## 📊 現在の実装状況

**更新日**: 2025年11月20日
**開発進捗**: 45%完成（Week 1-4 ほぼ完了 / 全8週間）

### ✅ Week 1: Google認証 + 店舗管理基盤（完了）

**実装済み機能:**

#### 1. 認証基盤
- ✅ Supabase プロジェクト作成（Tokyo リージョン）
- ✅ Google OAuth 認証フロー
  - ログイン画面（LoginPage.tsx）
  - 初回登録画面（RegisterPage.tsx）
  - 店舗コード検証機能
  - OAuth コールバック処理（AuthCallback.tsx）
- ✅ ログアウト機能
- ✅ 認証状態管理（AuthContext）

#### 2. データベース設計
```sql
stores (店舗マスタ)
├─ id: UUID
├─ store_code: TEXT (UNIQUE) ← 店舗識別コード
├─ store_name: TEXT
├─ region: TEXT
├─ status: TEXT (active/inactive)
└─ created_at, updated_at

profiles (ユーザープロフィール)
├─ id: UUID (auth.users連携)
├─ store_id: UUID → stores
├─ store_code: TEXT
├─ display_name: TEXT
├─ email: TEXT (UNIQUE)
├─ avatar_url: TEXT
├─ role: TEXT (admin/manager/user)
└─ created_at, last_active_at

conversations (会話履歴) ← Week 3で使用予定
├─ id: UUID
├─ user_id: UUID → profiles
├─ store_id: UUID → stores
├─ scenario_id: TEXT
├─ messages: JSONB
└─ duration_seconds, created_at

evaluations (評価履歴) ← Week 3で使用予定
├─ id: UUID
├─ conversation_id: UUID → conversations
├─ user_id: UUID → profiles
├─ scores: JSONB
├─ total_score: INT
└─ average_score, comments, created_at
```

#### 3. Row Level Security (RLS)
- ✅ ユーザーは自分のデータのみ閲覧・作成可能
- ✅ 店舗管理者は自店舗データを閲覧可能
- ✅ 本部管理者は全データ閲覧可能
- ✅ 循環参照問題を修正（profiles テーブルへの無限ループを解消）

#### 4. 管理機能
- ✅ 本部管理者専用の店舗管理画面
  - 店舗コード自動生成（8桁英数字）
  - 店舗一覧表示
  - 店舗の追加・削除
  - クリップボードコピー機能

#### 5. UI/UX
- ✅ ダークテーマで全画面統一
  - 暗いグラデーション背景: `from-[#0D0E20] via-[#16172B] to-[#272A46]`
  - ガラスカード効果: `backdrop-blur-xl`, `rgba(255, 255, 255, 0.08)`
  - パープルグラデーションボタン: `from-[#6C5CE7] to-[#A29BFE]`
- ✅ レスポンシブデザイン
- ✅ ローディング状態表示

**解決した技術課題:**
1. **RLS循環参照問題** - 管理者権限チェック時にprofilesテーブルを再参照し無限ループが発生
   - 解決策: ポリシーを簡素化し、認証ユーザー全員が閲覧可能に変更
2. **認証初期化の競合状態** - `initAuth()`と`onAuthStateChange()`が同時実行され読み込み無限ループ
   - 解決策: `isInitialized`フラグを導入し、初期化完了後のみイベント処理を実行
3. **環境変数の読み込みタイミング** - Viteサーバー再起動が必要
   - 解決策: .env変更後は必ずサーバー再起動を実行

**実装ファイル一覧:**
- `src/lib/supabase.ts` - Supabaseクライアント
- `src/contexts/AuthContext.tsx` - 認証状態管理
- `src/components/Auth/LoginPage.tsx` - ログイン画面
- `src/components/Auth/RegisterPage.tsx` - 初回登録画面
- `src/components/Auth/AuthCallback.tsx` - OAuthコールバック
- `src/components/Admin/StoreManagementPage.tsx` - 店舗管理画面
- `src/components/Header.tsx` - ヘッダー（ログアウト機能追加）
- `database/01_create_stores.sql` - storesテーブル作成
- `database/02_create_profiles.sql` - profilesテーブル作成
- `database/03_create_conversations.sql` - conversationsテーブル作成
- `database/04_create_evaluations.sql` - evaluationsテーブル作成
- `database/05_rls_policies.sql` - RLSポリシー設定
- `database/06_fix_rls_circular_reference.sql` - 循環参照修正

### 🔄 Week 2: 6シナリオ構築 + RAG構築（60%完了）

**実装済み:**
- ✅ **6シナリオのJSON作成完了**
  - meeting_1st（1次面談）
  - meeting_1_5th（1.5次面談）
  - meeting_2nd（2次面談）
  - meeting_3rd（3次面談）
  - kickoff_meeting（キックオフMTG）
  - upsell（追加営業）
- ✅ **音声データ準備完了**（27本のmp3ファイル）
- 🔄 **音声データの文字起こし**（3/27完了、進行中）
- 🔄 **RAGインデックス構築**（49件/600-800件目標、初期段階）

**実装ファイル一覧:**
- `scenarios/meeting_1st.json` - 1次面談シナリオ
- `scenarios/meeting_1_5th.json` - 1.5次面談シナリオ
- `scenarios/meeting_2nd.json` - 2次面談シナリオ
- `scenarios/meeting_3rd.json` - 3次面談シナリオ
- `scenarios/kickoff_meeting.json` - キックオフMTGシナリオ
- `scenarios/upsell.json` - 追加営業シナリオ
- `scenarios/index.json` - シナリオ一覧管理
- `videos/` - 27本の音声データ（mp3）
- `transcripts/` - 文字起こしファイル（3件完了）
- `rag_index/sales_patterns.faiss` - FAISSインデックス
- `rag_index/sales_patterns.json` - RAGパターンデータ（49件）

### ✅ Week 3: データ永続化（完了）

**実装済み機能:**
- ✅ **Supabase統合（バックエンド）**
  - 会話履歴保存API（`/api/conversations` POST/GET）
  - 評価履歴保存API（`/api/evaluations` POST/GET）
  - 自動保存機能
- ✅ **シナリオ切替UI**
  - 6シナリオ選択機能（ヘッダー）
  - シナリオ別に会話・評価を保存
  - リアルタイム同期

**実装ファイル一覧:**
- `app.py` - 会話・評価保存APIエンドポイント（L1073-1230）
- `src/components/Header.tsx` - シナリオ選択UI
- `src/lib/api.ts` - API通信ロジック

### ✅ Week 4: 履歴閲覧 + CSV出力（完了）

**実装済み機能:**
- ✅ **過去の練習一覧**（HistoryPage）
  - 会話履歴・評価履歴の表示
  - シナリオ別フィルター機能
  - 統計カード表示（総練習回数、評価完了回数、平均スコア）
- ✅ **会話の再生（読み返し）**
  - メッセージ一覧表示
  - 時間・期間の表示
- ✅ **評価の振り返り**
  - スコア詳細表示（質問力・傾聴力・提案力・クロージング力）
  - 総合評価・平均スコア表示
  - スコアの色分け表示（緑=4以上、黄=3以上、赤=3未満）
- ✅ **スコア推移グラフ**（ScoreChart）
  - 時系列でのスコア変化を可視化（recharts使用）
  - シナリオ別平均スコア表示
- ✅ **CSV出力機能**
  - 会話履歴CSV出力（downloadConversationsCSV）
  - 評価履歴CSV出力（downloadEvaluationsCSV）

**実装ファイル一覧:**
- `src/components/History/HistoryPage.tsx` - 履歴閲覧画面
- `src/components/History/ScoreChart.tsx` - スコア推移グラフ
- `src/lib/csv.ts` - CSV出力ロジック
- `src/lib/api.ts` - 履歴取得API（getConversations, getEvaluations）

### ⏳ 次の実装予定

**Week 2の残タスク（継続中）:**
- 音声データの文字起こし完了（24/27ファイル未完了）
- RAGデータベース拡充（49件 → 600-800件）

**Week 5以降（予定）:**
- Week 5: 評価精度向上（講師評価との一致率80%目標）
- Week 6: 店舗管理機能強化（店舗別レポート、ランキング）
- Week 7: パフォーマンス最適化（100店舗対応）
- Week 8: テスト・デプロイ

---

## 💰 概算コスト

### 開発費用

| 内容 | 工数 | 費用目安 |
|------|------|----------|
| Week 1: Google認証 + 店舗管理基盤 | 1週間 | 15-20万円 |
| Week 2: 6シナリオ + RAG構築 | 1週間 | 15-20万円 |
| Week 3: データ永続化 | 1週間 | 15-20万円 |
| Week 4: 履歴・CSV出力 | 1週間 | 15-20万円 |
| Week 5: 評価精度向上 | 1週間 | 20-25万円 |
| Week 6: 店舗管理機能 | 1週間 | 15-20万円 |
| Week 7: 最適化 | 1週間 | 15-20万円 |
| Week 8: テスト・デプロイ | 1週間 | 15-20万円 |
| **合計** | **8週間** | **125-165万円** |

### 運用費用（月額・100店舗想定）

| 項目 | 費用 | 備考 |
|------|------|------|
| Supabase Pro | 2,500円 | 100GBストレージ込み |
| バックエンドサーバー | 1-2万円 | Railway/Render（スケーラブル） |
| OpenAI API | 3-8万円 | 100店舗×月平均100回練習 |
| ドメイン・SSL | 数百円 | 年間費用 |
| **合計** | **3.5-10.5万円/月** | |

**OpenAI API コスト試算**:
```
1練習あたり:
- Whisper: 0.006 USD/分 × 5分 = 0.03 USD
- GPT-4o-mini: 0.15 USD/1Mトークン × 5000トークン = 0.0075 USD
- GPT-4（講評）: 2.5 USD/1Mトークン × 2000トークン = 0.005 USD
合計: 約0.04 USD = 6円/回

100店舗 × 月50回（平均） = 5,000回
5,000回 × 6円 = 30,000円/月

実際は3-8万円程度を想定
```

---

## 📺 UI構成

### メイン画面

```
┌─ Header ────────────────────────────────────────┐
│ [Avatar] 山田太郎（東京銀座店）                 │
│ [シナリオ選択▼] 1次面談                         │
│                                   [ログアウト]  │
├─────────────────────────────────────────────────┤
│  Main (grid layout)                             │
│  ┌─ ChatPanel ──────┬─ MediaPanel ───────────┐ │
│  │ • 会話履歴        │ • Video/Image          │ │
│  │ • 吹き出し形式    │ • 字幕                 │ │
│  │ • スクロール      │ • 録音ウェーブフォーム │ │
│  └──────────────────┴────────────────────────┘ │
├─ Footer (fixed) ────────────────────────────────┤
│  Composer                                       │
│  ├─ Textarea（自動リサイズ）                    │
│  ├─ 🎤 録音ボタン                               │
│  ├─ 📤 送信ボタン                               │
│  ├─ 🗑️ クリアボタン                             │
│  └─ 📊 講評ボタン                               │
└─────────────────────────────────────────────────┘
```

### シナリオ選択

```
[シナリオ選択 ▼]
├─ 1次面談（初回接触・関係構築）
├─ 1.5次面談（情報交換・信頼構築）
├─ 2次面談（提案・検討）
├─ 3次面談（クロージング）
├─ キックオフMTG（プロジェクト開始）
└─ 追加営業（既存顧客への提案）
```

### 講評シート

```
┌─ 評価結果 ─────────────────────────────────────┐
│  [総評] [良かった点] [改善点] [スコア]         │
├─────────────────────────────────────────────────┤
│  【総合評価】                                   │
│  平均スコア: 4.0点 / 5.0点                      │
│                                                 │
│  【スコア詳細】                                 │
│  ┌──────────────────┬─────────┐              │
│  │ ヒアリング力     │ ⭐⭐⭐⭐ 4点 │              │
│  │ 共感力           │ ⭐⭐⭐⭐⭐ 5点 │              │
│  │ 提案力           │ ⭐⭐⭐ 3点   │              │
│  │ 信頼構築力       │ ⭐⭐⭐⭐ 4点 │              │
│  └──────────────────┴─────────┘              │
│                                                 │
│  【良かった点】                                 │
│  ✅ SNS運用状況を自然に聞き出せていた           │
│  ✅ 相談者の不安に共感できていた                │
│                                                 │
│  【改善点】                                     │
│  ⚠️ 具体的な事例をもっと示すと良い              │
│  ⚠️ 次のステップを明確に提案すると◎            │
│                                                 │
│  [CSV出力] [閉じる]                             │
└─────────────────────────────────────────────────┘
```

---

## 🎯 完成時の機能一覧

### 営業担当者（一般ユーザー）

✅ Googleでログイン + 店舗コード入力（初回のみ）
✅ 6シナリオから選択して練習
✅ 音声 or テキスト入力
✅ AI相談者との自然な対話（600-800件のRAGデータ）
✅ リアルタイム字幕・映像
✅ SNS動画営業特化のAI講評（4軸評価）
✅ 履歴閲覧（シナリオ別フィルター・スコア推移グラフ）
✅ CSV出力（個人データ）

### 店舗管理者

✅ 自店舗メンバー管理
✅ 自店舗の練習状況確認
✅ 自店舗の平均スコア確認（シナリオ別）
✅ CSV出力（店舗データ）

### 本部管理者

✅ 店舗コード発行・管理（STORE_001形式）
✅ 全店舗のデータ閲覧
✅ 店舗別スコアランキング
✅ リージョン別集計
✅ CSV出力（全店舗データ）

---

## ✅ 導入メリット

### 営業トレーニングの革新

✅ **AI相談者との"実践型"トレーニングがいつでも可能**
- 講師や相手役のスケジュール調整不要
- 24時間いつでも、どこでも練習可能
- 失敗を恐れず何度でも繰り返し練習

✅ **6段階のシナリオで段階的にスキルアップ**
- 1次面談（警戒心あり）から追加営業（フランク）まで
- 関係性の変化をリアルに体験
- 実際の営業フローに沿った練習

✅ **実録音声30本から学習した自然な応答**
- 600-800件の多様なパターン
- シナリオに合った関係性・トーン
- 実際の相談者のようなリアルな対話

✅ **SNS動画営業特化の評価軸**
- ヒアリング力・共感力・提案力・信頼構築力
- 業界特有の課題に対応
- 具体的な改善点を明示

✅ **フランチャイズ100店舗対応**
- Google認証で簡単ログイン
- 店舗別管理・集計
- 全店舗の営業力を標準化

### ビジネス効果

| 効果カテゴリ | 具体的効果 | 期待値 |
| --- | --- | --- |
| **コスト削減** | 講師派遣費用の削減 | 年150〜300万円削減 |
| **教育効率化** | トレーニング時間の短縮 | 従来比50%短縮 |
| **スキル標準化** | 全店舗で統一された営業力 | 100店舗で一定レベル確保 |
| **新人育成** | 早期戦力化 | 育成期間を1/2に短縮 |
| **データ蓄積** | スコアデータで組織改善 | 傾向分析による施策立案 |

---

## 🚀 次のアクション

### 1️⃣ 音声データの準備

- 30本の無料相談録音データ（mp3/wav）を準備
- 各シナリオ5本ずつ × 30分

### 2️⃣ 開発開始

- Supabaseプロジェクト作成
- Google OAuth設定
- Week 1から順次開発

### 3️⃣ 店舗コード体系の決定

- STORE_001, STORE_002, ... STORE_100
- 本部管理者が事前に発行

### 4️⃣ 8週間後にリリース

- 本番環境にデプロイ
- パイロット店舗で試験運用
- 段階的に全店舗展開

---

## 📋 要件定義書作成情報

- **作成日**: 2025年1月11日
- **最終更新日**: 2025年1月11日
- **バージョン**: v4.0（SNS動画営業特化・6シナリオ対応版）
- **作成者**: AI Assistant
- **承認者**: 未定
- **更新内容**:
  - SNS動画制作会社向けに全面刷新
  - 6シナリオ対応（1次〜3次面談、キックオフ、追加営業）
  - Google認証 + 店舗コード（STORE_001形式）
  - 音声データ30本から学習
  - 評価軸をSNS動画営業特化に変更
  - 100店舗対応
  - 8週間開発スケジュール
- **次回更新予定**: 要件変更時

---

*この要件定義書はSNS動画営業ロープレ自動化システムの開発指針として使用されます。*
