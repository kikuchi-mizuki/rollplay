# 🎯 成功/失敗パターンの判定方法ガイド

## 📊 現在の実装状況

### ❌ 現在の制限事項

現在の実装では、**成功/失敗の自動判定は行われていません**。

- `extract_sales_patterns`関数は、営業の発言パターン（good_question, objection_handling, closing）を抽出するのみ
- 会話の結果（契約成立、断られた、保留など）は判定されていない
- RAGインデックスにも成功/失敗の情報は含まれていない

### ✅ 将来の改善予定

成功/失敗の判定機能を追加予定です。現在は手動での分類を推奨します。

## 🔍 成功/失敗の判断基準

### 1. **成功パターンの特徴**

#### 会話の流れ
- ✅ ヒアリング → 提案 → クロージングまでの流れがスムーズ
- ✅ 顧客の課題を適切に引き出せている
- ✅ 異論に対して適切に応答できている
- ✅ 最終的に次のアクション（契約、面談、資料送付など）が決まっている

#### 具体的な指標
- **契約成立**: 「契約します」「お願いします」「進めましょう」
- **アクション決定**: 「来週の月曜日で」「資料を送ってください」「検討します」
- **ポジティブな反応**: 「魅力的ですね」「興味があります」「考えてみます」
- **質問の多さ**: 顧客が積極的に質問している
- **時間の長さ**: 30分程度の無料相談が最後まで進んでいる

#### 会話例（成功パターン）
```
営業: 「月額5万円で、動画制作から公開まで対応します」
顧客: 「それは魅力的ですね。契約したいと思います」
営業: 「ありがとうございます。それでは、来週の月曜日から始められますか？」
顧客: 「はい、お願いします」
```

### 2. **失敗パターンの特徴**

#### 会話の流れ
- ❌ ヒアリングが浅い（課題を引き出せていない）
- ❌ 提案が顧客のニーズと合っていない
- ❌ 異論に対して適切に応答できていない
- ❌ クロージングが弱い、またはタイミングが悪い
- ❌ 会話が短い（途中で終わっている）

#### 具体的な指標
- **明確な断り**: 「今回は見送ります」「興味がありません」「検討しません」
- **消極的な反応**: 「もう少し考えます」「他社と比較します」「予算がありません」
- **会話の中断**: 途中で会話が終わっている
- **異論の増加**: 顧客の懸念が解消されていない
- **時間の短さ**: 10分程度で終わっている

#### 会話例（失敗パターン）
```
営業: 「月額5万円で、動画制作から公開まで対応します」
顧客: 「それは高いですね。他社と比較してみます」
営業: 「でも、弊社のサービスは...」
顧客: 「すみません、今回は見送らせていただきます」
```

## 🛠️ データ準備時の分類方法

### 方法1: ファイル名で分類（推奨）

音声ファイルを以下の命名規則で保存：

```
videos/
├── 01_ヒアリング_成功_課題の引き出し_001.wav
├── 01_ヒアリング_失敗_浅いヒアリング_002.wav
├── 02_提案_成功_プラン説明_001.wav
├── 02_提案_失敗_ニーズ不一致_002.wav
├── 03_価格_成功_価格交渉_001.wav
├── 03_価格_失敗_価格交渉_002.wav
├── 04_クロージング_成功_契約成立_001.wav
└── 04_クロージング_失敗_断られた_002.wav
```

**命名規則:**
```
[段階番号]_[段階名]_[成功/失敗]_[内容]_[連番].wav
```

### 方法2: メタデータJSON（手動分類）

各音声ファイルに対応するメタデータJSONを作成：

```json
{
  "video_id": "001",
  "stage": "ヒアリング",
  "outcome": "success",
  "reason": "課題を適切に引き出せた",
  "indicators": [
    "顧客が積極的に質問している",
    "具体的な課題が明確になった",
    "会話が自然に進んでいる"
  ],
  "sub_category": "課題の引き出し",
  "duration": 300,
  "tags": ["質問", "現状把握", "課題発見", "成功"],
  "expected_flow": ["greeting", "needs_analysis"],
  "pattern_type": "good_question"
}
```

### 方法3: ディレクトリ構造で分類

```
videos/
├── 01_ヒアリング/
│   ├── success/
│   │   ├── 課題の引き出し_001.wav
│   │   └── 予算感の確認_002.wav
│   └── failure/
│       ├── 浅いヒアリング_001.wav
│       └── 質問が少ない_002.wav
├── 02_提案/
│   ├── success/
│   └── failure/
└── ...
```

## 📈 成功/失敗の判定基準（詳細）

### 成功パターンの5段階評価

| 評価項目 | 5点（優秀） | 4点（良好） | 3点（普通） | 2点（要改善） | 1点（失敗） |
|---------|-----------|-----------|-----------|------------|-----------|
| **質問力** | 核心を的確に把握 | 深掘り質問あり | 状況に応じた質問 | 一般的な質問のみ | 質問なし |
| **傾聴力** | 背景まで理解 | 共感・確認を示す | 内容を理解 | 表面的な理解 | 話を聞いていない |
| **提案力** | 顧客固有に最適化 | 具体的な提案 | 一般的な提案 | 抽象的提案 | 提案なし |
| **クロージング力** | 自然で効果的 | 適切なタイミング | 弱いクロージング | 唐突な押し付け | クロージングなし |

### 成功の定義

- **総合スコア**: 16点以上（4点×4項目）→ 成功
- **クロージング**: 5点 → 必ず成功
- **アクション決定**: 次のステップが明確 → 成功

### 失敗の定義

- **総合スコア**: 12点未満（3点×4項目）→ 失敗
- **明確な断り**: 顧客が明確に断った → 失敗
- **会話の中断**: 途中で終わっている → 失敗

## 🤖 将来的な自動判定の実装予定

### 実装予定機能

1. **会話結果の自動判定**
   - 会話の最後の発言から成功/失敗を判定
   - キーワードベースの判定（「契約します」「見送ります」など）

2. **評価スコアに基づく分類**
   - 講評生成時に自動で成功/失敗を判定
   - 総合スコアが基準値以上なら成功

3. **RAGインデックスへの反映**
   - 成功/失敗の情報をメタデータに追加
   - 検索時に成功パターンを優先的に参照

### 実装イメージ

```python
def classify_outcome(utterances: List[Dict[str, str]]) -> str:
    """会話の結果（成功/失敗）を判定"""
    # 最後の発言を確認
    last_utterance = utterances[-1].get('text', '')
    
    # 成功パターン
    success_keywords = ['契約', 'お願い', '進め', '決め', '検討します', '興味があります']
    if any(keyword in last_utterance for keyword in success_keywords):
        return 'success'
    
    # 失敗パターン
    failure_keywords = ['見送り', '興味なし', '検討しません', '他社', '予算がありません']
    if any(keyword in last_utterance for keyword in failure_keywords):
        return 'failure'
    
    # 判定不能
    return 'unknown'
```

## 📝 データ準備時の推奨事項

### 1. **成功パターンを多めに**
- 成功パターン：70-80%
- 失敗パターン：20-30%
- 成功パターンが多い方が、AIが良い応答を学習しやすい

### 2. **失敗パターンも重要**
- 失敗パターンから、避けるべき対応を学習できる
- 異論処理の改善に役立つ

### 3. **バランスの取れたデータ**
- 各段階で成功・失敗の両方を含める
- 特に価格交渉とクロージング段階は重要

### 4. **メタデータの記録**
- ファイル名またはメタデータJSONで成功/失敗を記録
- 将来的な自動判定機能の実装に備える

## 🎯 まとめ

### 現在の状況
- ✅ 手動での分類は可能（ファイル名、メタデータ）
- ❌ 自動判定は未実装
- ⚠️ データ取り込み時に成功/失敗の情報は保持されない

### 推奨アクション
1. **ファイル名で分類**: `[段階]_[成功/失敗]_[内容].wav`
2. **メタデータJSONを作成**: 成功/失敗の理由を記録
3. **バランスの取れたデータ**: 成功70-80%、失敗20-30%
4. **各段階で両方を含める**: 特に価格交渉とクロージング

### 将来的な改善
- 自動判定機能の実装
- RAGインデックスへの成功/失敗情報の反映
- 検索時の成功パターン優先



